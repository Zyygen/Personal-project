<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <!-- CSS chung -->
  <link rel="stylesheet" th:href="@{/css/header_ad.css}">
  <link rel="stylesheet" th:href="@{/css/footer.css}">
  <!-- CSS ri√™ng trang ng∆∞·ªùi d√πng -->
  <link rel="stylesheet" th:href="@{/css/admin-users.css}">
</head>
<body class="d-flex flex-column min-vh-100 admin-users">

  <!-- Navbar -->
  <div th:replace="fragments/header_ad :: adminHeader"></div>

  <main class="flex-grow-1">
    <div class="container my-4">

      <!-- Ti√™u ƒë·ªÅ -->
      <h2 class="mb-4 text-center page-title">üìã Danh s√°ch t√†i kho·∫£n ng∆∞·ªùi d√πng</h2>

      <!-- Th√¥ng b√°o (n·∫øu c√≥) -->
      <div id="flash" class="mb-3">
        <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
          <i class="bi bi-check-circle me-2"></i>
          <span th:text="${message}">C·∫≠p nh·∫≠t th√†nh c√¥ng.</span>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="bi bi-x-circle me-2"></i>
          <span th:text="${error}">C√≥ l·ªói x·∫£y ra.</span>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      </div>

      <!-- B·∫£ng ng∆∞·ªùi d√πng -->
      <div class="table-wrap">
        <div class="table-responsive">
          <table class="table table-hover mb-0 text-center align-middle">
            <thead>
              <tr>
                <th style="width:80px">ID</th>
                <th style="min-width:220px">T√™n ƒëƒÉng nh·∫≠p</th>
                <th style="min-width:220px">M·∫≠t kh·∫©u m·ªõi</th>
                <th style="width:140px">C·∫≠p nh·∫≠t</th>
                <th style="width:120px">X√≥a</th>
              </tr>
            </thead>
            <tbody>
              <!-- CH·ªà hi·ªÉn th·ªã ROLE_USER -->
              <tr th:each="u : ${users}" th:if="${u.role == 'ROLE_USER'}">

                <!-- ID -->
                <td th:text="${u.id}">1</td>

                <!-- Username (g·∫Øn v√†o form c·∫≠p nh·∫≠t b·∫±ng thu·ªôc t√≠nh form=...) -->
                <td>
                  <input type="text"
                         class="form-control form-control-sm text-center"
                         name="username"
                         th:value="${u.username}"
                         th:attr="form=${'form__' + u.id}"
                         required />
                </td>

                <!-- Password m·ªõi (kh√¥ng b·∫Øt bu·ªôc) -->
                <td>
                  <input type="password"
                         class="form-control form-control-sm text-center"
                         name="password"
                         placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi"
                         th:attr="form=${'form__' + u.id}" />
                </td>

                <!-- N√∫t c·∫≠p nh·∫≠t: form ƒë·∫∑t trong √¥ ri√™ng, inputs tham chi·∫øu b·∫±ng form=... -->
                <td>
                  <form th:id="${'form__' + u.id}"
                        th:action="@{'/admin/user/update/' + ${u.id}}"
                        method="post" class="d-grid">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" class="btn btn-primary btn-sm">C·∫≠p nh·∫≠t</button>
                  </form>
                </td>

                <!-- X√≥a -->
                <td>
                  <form th:action="@{'/admin/user/delete/' + ${u.id}}"
                        method="post"
                        class="d-grid"
                        onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n n√†y?');">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" class="btn btn-outline-danger btn-sm">X√≥a</button>
                  </form>
                </td>

              </tr>

              <!-- Kh√¥ng c√≥ d·ªØ li·ªáu -->
              <tr th:if="${#lists.isEmpty(users)}">
                <td colspan="5" class="text-muted py-4">Kh√¥ng c√≥ t√†i kho·∫£n n√†o.</td>
              </tr>

            </tbody>
          </table>
        </div>
      </div>

    </div>
  </main>

  <div th:replace="fragments/footer :: siteFooter"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script th:src="@{/js/footer.js}"></script>
</body>
</html>

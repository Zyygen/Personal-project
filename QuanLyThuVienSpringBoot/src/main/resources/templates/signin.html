<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <title>Đăng nhập</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: url("/uploads/background.jpg") no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
        }
        .login-container { min-height: 100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; }
        .login-form {
            background: rgba(255,255,255,0.45);
            backdrop-filter: blur(5px);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(31,38,135,0.19);
            padding: 2.2rem 2rem 1.6rem 2rem;
            max-width: 350px; width: 100%; margin: 0 auto;
        }
        .login-header{
		  display:flex;
		  align-items:center;      
		  justify-content:center;  
		  gap:.55rem;              
		  margin-bottom:1rem;
		  transform:translateX(-6px); 
		}
        .input-group { position:relative; margin-bottom:1.15rem; }
        .input-icon { position:absolute; left:15px; top:50%; transform:translateY(-50%); color:#4cc3ff; font-size:1.15rem; z-index:10; }
        .form-control { border-radius: 2rem!important; border:none; background:#e6ecf1; padding-left:2.5rem; font-size:1.06rem; color:#222; height:44px; }
        .form-control:focus { background:#eaf6ff; box-shadow:0 0 0 2px #8fd0fa77; }
        .form-control::placeholder { color:#8fc8e9; opacity:1; font-size:1.06rem; font-weight:500; }
        .btn-login {
            background:#4cc3ff; color:#fff; font-weight:bold; border-radius:2rem; width:100%; margin-top:.5rem; padding:.65rem 0; font-size:1.09rem; border:none;
            box-shadow:0 3px 12px #4cc3ff33; transition:background .2s;
        }
        .btn-login:hover, .btn-login:focus { background:#2188d1; color:#fff; }
        .login-extra { margin-top:1.1rem; text-align:center; background:rgba(255,255,255,0.15); backdrop-filter: blur(4px); border-radius:1.2rem; padding:.5rem 0; font-weight:bold; }
        .login-extra a { color:#4cc3ff!important; font-weight:bold; text-decoration:underline; }
        .login-extra a:hover { color:#2188d1!important; }
        .alert { margin-top:1.2rem; }
        .toggle-pass { position:absolute; right:14px; top:50%; transform:translateY(-50%); cursor:pointer; color:#4cc3ff; }
        .remember-wrap { display:flex; align-items:center; gap:.5rem; margin-top:.25rem; }
        /* Nút Home gắn vào góc form */
		.login-form{ position:relative; } /* cần để vị trí tuyệt đối bám vào form */
		.brand-home{
		  display:inline-flex;
		  align-items:center;
		  justify-content:center;
		  width:40px; height:40px;           
		  border-radius:50%;
		  overflow:hidden;                    
		  border:1.5px solid rgba(255,255,255,.65);
		  background:rgba(11,55,97,.9);
		  box-shadow:0 6px 18px rgba(0,0,0,.25);
		  text-decoration:none;
		  transition:transform .12s, box-shadow .12s;
		}
		.brand-home img{
		  width:30px; height:30px;         
		  object-fit:cover;
		  border-radius:50%;
		  display:block;
		}
		.brand-home:hover{
		  transform:translateY(-1px);
		  box-shadow:0 10px 24px rgba(0,0,0,.30);
		}
		.login-title{
 		 margin:0;
		  line-height:40px;                 
		  text-align:center;
		  font-size:1.6rem;
		  font-weight:600;
		  letter-spacing:2px;
		  color:#1e07ed;
		  text-shadow:0 2px 8px #fff4;
		}
		@media (max-width:576px){
		  .brand-home{ top:-12px; left:-12px; width:40px; height:40px; }
		}
    </style>
</head>
<body>
<div class="login-container">
    <form class="login-form" method="post" th:action="@{/signin}">
	  <div class="login-header">
	    <a class="brand-home" th:href="@{/home}" aria-label="Trang chủ" title="Trang chủ">
	      <img th:src="@{/uploads/logo-eaut.jpg}" alt="EAUT">
	    </a>
	    <div class="login-title">LOGIN</div>
	  </div>

        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <div class="input-group">
            <span class="input-icon"><i class="fa fa-envelope"></i></span>
            <input type="text" class="form-control" name="username" placeholder="Email" required autocomplete="username"
                   th:value="${param.email} ?: ${session.LAST_USERNAME}" />
        </div>

        <div class="input-group">
            <span class="input-icon"><i class="fa fa-lock"></i></span>
            <input id="password" type="password" class="form-control" name="password" placeholder="Password" required autocomplete="current-password" />
            <span class="toggle-pass" onclick="togglePass(event)"><i class="fa fa-eye"></i></span>
        </div>

        <div class="remember-wrap">
            <input type="checkbox" id="remember-me" name="remember-me">
            <label for="remember-me" class="mb-0">Ghi nhớ đăng nhập</label>
        </div>

        <button type="submit" class="btn btn-login mt-2">Đăng nhập</button>

        <div class="login-extra mt-3">
            Bạn chưa có tài khoản?
            <a th:href="@{/signup}" class="ms-1">Đăng ký</a>
            <a th:href="@{/forgot-password}" class="ms-2">Quên mật khẩu?</a>
            <!-- Link gửi lại: tự động lấy email đang nhập -->
            <a th:href="@{/verify/resend}" class="ms-2" onclick="resendVerify()">Gửi lại email xác nhận</a>
        </div>

        <!-- ==== Thông báo ==== -->
        <!-- Đăng xuất -->
        <div class="alert alert-success" th:if="${param.logout}">
            Bạn đã đăng xuất.
        </div>

        <!-- Message từ flash attributes: verify thành công, resend thành công… -->
        <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <!-- Lỗi đăng nhập: ?error, ?error=unverified, ?error=locked -->
        <div th:if="${param.error}" class="alert alert-danger mt-3">
            <!-- Nếu ?error không có giá trị (bad credentials) -->
            <span th:if="${#lists.isEmpty(param.error)}">Email hoặc mật khẩu không đúng.</span>

            <!-- Nếu có giá trị -->
            <span th:if="${!#lists.isEmpty(param.error)}" th:switch="${param.error[0]}">
                <span th:case="'unverified'">
                    Tài khoản của bạn <b>chưa được kích hoạt</b>. Vui lòng kiểm tra email để xác nhận.
                </span>
                <span th:case="'locked'">
                    Tài khoản đã bị khóa. Vui lòng liên hệ quản trị viên.
                </span>
                <span th:case="*">Email hoặc mật khẩu không đúng.</span>
            </span>
        </div>
    </form>
</div>

<script>
    function togglePass(ev){
        const input = document.getElementById('password');
        const icon = ev.currentTarget.querySelector('i');
        if(input.type === 'password'){
            input.type = 'text';
            icon.classList.remove('fa-eye'); icon.classList.add('fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye-slash'); icon.classList.add('fa-eye');
        }
    }
</script>
</body>
</html>
